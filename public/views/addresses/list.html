<div class="row">
  <div class="col-lg-12 text-center">
    <h2><%- T('Receive Addresses') %></h2>
      <hr>
  </div>
</div>

<div class="row">
  <div class="col-lg-12">
    <div id="addresses">
      <% if(data.addresses.length == 0) {%>
        <h4><%- T('No receive address yet.') %></h4>
      <% } else { %>
      <% var zeroAddresses = 0; %>
      <div class="clearfix">
	<div style="float:right"><input type="checkbox" data-toggle="switch" id="zero-balance-toggle" <% if(richwallet.controllers.addresses.isZeroBalanceAddressesHidden()){ %>checked<% } %>></div>
	<label style="float:right; line-height: 1.4;padding-top:5px;font-size:15px; padding-right:30px"><%- T("Hide no money addresses") %>&nbsp;</label>
      </div>
        
        <div class="hidden-lg hidden-md">
          <% for(var i=0;i<data.addresses.length;i++) { %>
	    <% if(! data.balances[data.addresses[i].address]) zeroAddresses++; %>
	    <%
	       var zeroBalanceClass = "zero-balance";
	       var zeroHiddenClass = "";
	       if(data.balances[data.addresses[i].address])
	         zeroBalanceClass = "";
	       else if(richwallet.controllers.addresses.isZeroBalanceAddressesHidden())
	         zeroHiddenClass = "hidden";
	    %>
              <div class="row <%- zeroBalanceClass %> <%- zeroHiddenClass %>" data-address="<%- data.addresses[i].address %>">
		<div class="col-md-6">
		  <div>
                    <strong><%- data.addresses[i].name || T('No Label') %></strong>
                    <span class="addExchangePrice pull-right" style="color: #33CC33;">
                      <%- data.balances[data.addresses[i].address] || 0 %> <%- richwallet.config.networkConfigs[data.addresses[i].network].currency %>
                    </span>
		  </div>
		  <div><%- data.addresses[i].address %></div>
		  <div>
		    <div class="text-right">
		      <span class="dropdown" >
			<a href="#/addresses/request/<%- data.addresses[i].address %>" class="btn btn-link"><i class="fa fa-qrcode"></i> <%- T('Request Payment') %></a>

			<a class="btn btn-link dropdown-toggle" data-toggle="dropdown" role="button" href="#"><span class="fa fa-bars"></span><span class="hidden"><%- T("More") %></span></a>
			<span class="dropdown-arrow dropdown-arrow-inverse"></span>
			<ul class="dropdown-menu dropdown-inverse text-left" role="menu">
			  <li>
			    <a role="menuitem" tabindex="-1" href="#" onclick="richwallet.controllers.addresses.editLabel('<%- data.addresses[i].address %>'); return false;"><i class="fa fa-edit"></i> <%- T("Edit Label") %></a>
			  </li>
			  <li>
			    <a role="menuitem" href="javascript:void(0);" onclick="richwallet.controllers.addresses.showExportPrivateKey('<%- data.addresses[i].address %>');"><i class="fa fa-archive"></i> <%- T("Export Private Key") %></a>
			  </li>
			  <li>
			    <a role="menuitem" href="javascript:void(0);" onclick="richwallet.controllers.addresses.showDeleteAddress('<%- data.addresses[i].address %>');"><i class="fa fa-scissors"></i> <%- T("Delete Address") %></a>
			  </li>
			</ul>
		      </span>
		     </div>
		  </div>
		</div>
		<hr>
              </div>
          <% } %>
        </div>
        <div class="visible-md visible-lg">
          <table class="table table-bordered table-striped table-hover">
            <thead>
              <tr>
                <th><%- T('Label') %></th>
                <th><%- T('Address') %></th>
                <th><%- T('Network') %></th>
                <th>
		  <%- T('Balance') %>
                </th>
		<th>&nbsp;</th>
                <!--
                <th>Backups</th>
                <th>Receive QR Code</th>
                -->
              </tr>
            </thead>
            <tbody>
              <% for(var i=0; i<data.addresses.length; i++) { %>
		 <%
		    var zeroBalanceClass = "zero-balance";
		    var zeroHiddenClass = "";
		    if(data.balances[data.addresses[i].address])
	              zeroBalanceClass = "";
		    else if(richwallet.controllers.addresses.isZeroBalanceAddressesHidden())
	              zeroHiddenClass = "hidden";
		 %>
                 <tr class="<%- zeroBalanceClass %> <%- zeroHiddenClass %>" data-address="<%- data.addresses[i].address %>">
                   <td><%- data.addresses[i].name %></td>
                   <td><%- data.addresses[i].address %></td>
                   <td><%- T(data.addresses[i].network)  %></td>
                   <td>
                     <span class="addExchangePrice">
                       <%- data.balances[data.addresses[i].address] || 0 %>  <%- richwallet.config.networkConfigs[data.addresses[i].network].currency %>
                     </span>
                   </td>
                   <td>
		     <div style="display:inline-block" class="dropdown">
                       <a href="#/addresses/request/<%- data.addresses[i].address %>" class="btn btn-link fix-btn"><i class="fa fa-qrcode"></i> <%- T('Request Payment') %></a>
		       <a class="btn btn-link dropdown-toggle fix-btn" data-toggle="dropdown" role="button" href="#"><span class="fa fa-bars"></span><span class="hidden"><%- T("More") %></span></a>
		       <ul class="dropdown-menu dropdown-inverse" role="menu">
			 <li>
			   <a role="menuitem" tabindex="-1" href="#" onclick="richwallet.controllers.addresses.editLabel('<%- data.addresses[i].address %>'); return false;"><i class="fa fa-edit"></i> <%- T("Edit Label") %></a>
			 </li>
			 <li>
			   <a role="menuitem" href="javascript:void(0);" onclick="richwallet.controllers.addresses.showExportPrivateKey('<%- data.addresses[i].address %>');"><i class="fa fa-archive"></i> <%- T("Export Private Key") %></a>
			 </li>
			  <li>
			    <a role="menuitem" href="javascript:void(0);" onclick="richwallet.controllers.addresses.showDeleteAddress('<%- data.addresses[i].address %>');"><i class="fa fa-scissors"></i> <%- T("Delete Address") %></a>
			  </li>
		       </ul>
		     </div>
                   </td>
                 </tr>
		<% } %>
            </tbody>
          </table>
        </div>
	<div style="text-align:right;" class="zero-balance-show <% if(!richwallet.controllers.addresses.isZeroBalanceAddressesHidden()) { %>hidden<% } %>">
	  <label style="font-size:15px;line-height:30px;"><%- T("%s addresses has been hidden.", zeroAddresses) %></label>
	  <button type="button" class="btn btn-link" onclick="$('#zero-balance-toggle').parents('div.switch').bootstrapSwitch('toggleState',true);"><%- T('Show') %></button>
	</div>

      <% } %>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-lg-6">
    <h2><%- T('New Address') %></h2>
    <form onsubmit="richwallet.controllers.addresses.generateNewAddress($('#addressNetwork').val(), $('#addressLabel').val()); return false;">
      <div>
        <%- T('Label') %> <small>(<%- T('optional') %>)</small>: <input id="addressLabel" type="text" style="width: 200px">
	<select id="addressNetwork">
	  <% _.map(richwallet.config.sortedNetworks, function(network){ %>
	  <option value="<%- network %>"><%- T(network) %></option>
	  <% }); %>
	</select>
	<button class="btn btn-primary"><i class="fa fa-plus"></i> <%- T('Generate') %></button>
        <div id="newAddressDialog" class="alert alert-success alert-dismissable hidden">
          <button type="btn" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
          <span id="newAddressMessage"></span>
        </div>
      </div>
    </form>
  </div>
</div>

<div class="modal fade" id="editLabel" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
	<h4 class="text-center"><%- T('Edit Label') %></h4>
      </div>
      <form>
      <div class="modal-body">
	<div class="form-group clearfix">
	  <div class="col-lg-12">
	    <input type="text" name="addressName" class="form-control" placeholder="<%- T('Please input a label') %>" maxlength="24" />
	  </div>
	</div>
      </div>
      <div class="modal-footer">
	<button type="button" class="btn btn-default" data-dismiss="modal"><%- T('Cancel') %></button>
	<button type="submit" class="btn btn-primary"><%- T('Confirm') %></button>
      </div>
      </form>
    </div>
  </div>
</div>

<div class="modal fade" id="privateKeyDialog" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
	<h4 class="text-center"><%- T('Export Private Key') %></h4>
      </div>
      <div class="modal-body">
	<div class="form-group clearfix">
	  <div class="text-center text-danger">
	    <span style="font-size: 16px;word-break: break-all; word-wrap: break-word;"></span>
	    <br/>
	    <strong><%- T("Please take care of your private key!") %></strong>
	  </div>
	</div>
	<div class="modal-footer">
	  <button type="button" class="btn btn-default" data-dismiss="modal"><%- T('Close') %></button>
	</div>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="exportPrivateKeyDialog" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
	<h4 class="text-center"><%- T('Export Private Key') %></h4>
      </div>
      <form action="#" onsubmit="richwallet.controllers.addresses.exportPrivateKey(); return false;">
	<div class="modal-body">
	  <div class="form-group clearfix">
	    <div class="col-lg-12 text-center">
	      <strong><%- T('The private key of the address %s will be exported.') %></strong><input type="hidden" name="address"/>
	    </div>
	  </div>
	  <div class="form-group clearfix">
	    <!-- <label for="password" class="col-lg-2 control-label"><%- T('Login password') %></label> -->
	    <div class="col-lg-6 col-lg-offset-3">
	      <input type="password" step="any" name="password" class="form-control" placeholder="<%- T('Please input you password') %>" />
	    </div>
	  </div>
	</div>
	<div class="alert alert-danger hidden">
	</div>
	<div class="modal-footer">
	  <button type="button" class="btn btn-default" data-dismiss="modal"><%- T('Close') %></button>
          <button type="submit" id="quickSendButton" class="btn btn-primary"><%- T('Export') %></button>
	</div>
      </form>
    </div>
  </div>
</div>
<div class="modal fade" id="deleteAddressDialog" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
	<h4 class="text-center"><%- T('Delete Address') %></h4>
      </div>
      <form action="#" onsubmit="richwallet.controllers.addresses.remindDeleteAddress(); return false;">
	<div class="modal-body">
	  <div class="form-group clearfix">
	    <div class="col-lg-12 text-center">
	      <strong><%- T('This address %s will be deleted.') %></strong><input type="hidden" name="address"/>
	    </div>
	  </div>
	  <div class="form-group clearfix">
	    <!-- <label for="password" class="col-lg-2 control-label"><%- T('Login password') %></label> -->
	    <div class="col-lg-6 col-lg-offset-3">
	      <input type="password" step="any" name="password" class="form-control" placeholder="<%- T('Please input you password') %>" />
	    </div>
	  </div>
	</div>
	<div class="alert alert-danger hidden">
	</div>
	<div class="modal-footer">
	  <button type="button" class="btn btn-default" data-dismiss="modal"><%- T('Close') %></button>
          <button type="submit" id="deleteAddress" class="btn btn-primary"><%- T('Delete') %></button>
	</div>
      </form>
    </div>
  </div>
</div>
<div class="modal fade" id="remindDeleteAddressDialog" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
	<h4 class="text-center"><%- T('Delete Address') %></h4>
      </div>
      <div class="modal-body">
	<div class="form-group clearfix">
	  <div class="text-center text-danger">
	    <span style="font-size: 16px;word-break: break-all; word-wrap: break-word;"></span>
	    <strong><%- T("Address deleted cannot be retrieved anymore, sure to do this?") %></strong>
	  </div>
	</div>
	<div class="modal-footer">
      <form action="#" onsubmit="richwallet.controllers.addresses.deleteAddress(); return false;">
	<button type="button" class="btn btn-default" data-dismiss="modal"><%- T('Cancel') %></button>
	<button type="submit" class="btn btn-primary"><%- T('Confirm') %></button>
	  </form>
	</div>
      </div>
    </div>
  </div>
</div>

<script>
  $("#zero-balance-toggle").wrap('<div class="switch" />').parent().bootstrapSwitch().on("switch-change",function(e,v){richwallet.controllers.addresses.toggleZeroBalanceAddressesHidden(v.value);});
  $(".dropdown-toggle").dropdown();
</script>
